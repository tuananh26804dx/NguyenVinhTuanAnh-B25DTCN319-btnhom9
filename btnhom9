#include <stdio.h>
#include <string.h>

// Cau truc ngay sinh
typedef struct {
    int ngay, thang, nam;
} NgaySinh;

// Cau truc sinh vien
typedef struct {
    char maSV[7];      // Ma sinh vien toi da 6 ky tu
    char hoTen[21];    // Ho ten toi da 20 ky tu
    char gioiTinh[4];  // Gioi tinh: nam hoac nu
    char soDT[11];     // So dien thoai toi da 10 ky tu
    NgaySinh ns;       // Ngay sinh gom ngay thang nam
} SinhVien;

// Ham nhap thong tin 1 sinh vien
void nhap1SV(SinhVien *sv) {
    fflush(stdin); // Xoa bo dem de nhap chuoi

    printf("Nhap ma sinh vien: ");
    gets(sv->maSV); // Nhap ma sinh vien

    printf("Nhap ho ten: ");
    gets(sv->hoTen); // Nhap ho ten

    printf("Nhap gioi tinh: ");
    gets(sv->gioiTinh); // Nhap gioi tinh

    printf("Nhap so dien thoai: ");
    gets(sv->soDT); // Nhap so dien thoai

    printf("Nhap ngay thang nam sinh: ");
    scanf("%d %d %d", &sv->ns.ngay, &sv->ns.thang, &sv->ns.nam); // Nhap ngay sinh
}

// Ham hien thi thong tin 1 sinh vien
void hienThi1SV(SinhVien sv) {
    printf("%-10s %-20s %-5s %-12s %02d/%02d/%04d\n",
           sv.maSV, sv.hoTen, sv.gioiTinh, sv.soDT,
           sv.ns.ngay, sv.ns.thang, sv.ns.nam); // In thong tin sinh vien
}

// Ham hien thi danh sach sinh vien
void hienThiDS(SinhVien a[], int n) {
    if (n == 0) { // Kiem tra neu danh sach rong
        printf("Danh sach rong!\n");
        return;
    }
    for (int i = 0; i < n; i++) {
        hienThi1SV(a[i]); // Goi ham in tung sinh vien
    }
}

// Ham them 1 sinh vien vao dau mang
void themSV(SinhVien a[], int *n) {
    for (int i = *n; i > 0; i--) {
        a[i] = a[i - 1]; // Doi tat ca cac phan tu sang phai
    }
    nhap1SV(&a[0]); // Nhap sinh vien moi vao vi tri 0
    (*n)++; // Tang so luong sinh vien
}

// Ham tim vi tri sinh vien theo ma
int timTheoMa(SinhVien a[], int n, char ma[]) {
    for (int i = 0; i < n; i++) {
        if (strcmp(a[i].maSV, ma) == 0) // So sanh chuoi
            return i; // Tra ve vi tri neu trung
    }
    return -1; // Khong tim thay
}

// Ham cap nhat sinh vien (khong cap nhat ma)
void capNhatSV(SinhVien a[], int n) {
    char ma[7];
    printf("Nhap ma sinh vien can cap nhat: ");
    fflush(stdin);
    gets(ma); // Nhap ma sinh vien can cap nhat

    int vt = timTheoMa(a, n, ma); // Tim vi tri sinh vien
    if (vt == -1) {
        printf("Khong tim thay sinh vien!\n");
        return;
    }

    printf("Nhap thong tin moi cho sinh vien (tru ma SV):\n");
    fflush(stdin);
    printf("Nhap ho ten: ");
    gets(a[vt].hoTen); // Cap nhat ten

    printf("Nhap gioi tinh: ");
    gets(a[vt].gioiTinh); // Cap nhat gioi tinh

    printf("Nhap so dien thoai: ");
    gets(a[vt].soDT); // Cap nhat so dien thoai

    printf("Nhap ngay thang nam sinh: ");
    scanf("%d %d %d", &a[vt].ns.ngay, &a[vt].ns.thang, &a[vt].ns.nam); // Cap nhat ngay sinh

    printf("Cap nhat thanh cong!\n");
}

// Ham xoa sinh vien theo ma
void xoaSV(SinhVien a[], int *n) {
    char ma[7];
printf("Nhap ma sinh vien can xoa: ");
    fflush(stdin);
    gets(ma); // Nhap ma can xoa

    int vt = timTheoMa(a, *n, ma); // Tim vi tri can xoa
    if (vt == -1) {
        printf("Khong tim thay sinh vien!\n");
        return;
    }

    for (int i = vt; i < *n - 1; i++) {
        a[i] = a[i + 1]; // Day cac phan tu ben phai sang trai
    }

    (*n)--; // Giam so luong
    printf("Xoa thanh cong!\n");
}

// Ham tim kiem theo ten
void timTheoTen(SinhVien a[], int n) {
    char ten[21];
    printf("Nhap ten can tim: ");
    fflush(stdin);
    gets(ten); // Nhap ten can tim

    int found = 0; // Bien danh dau tim thay hay chua
    for (int i = 0; i < n; i++) {
        if (strstr(a[i].hoTen, ten) != NULL) { // Tim chuoi con trong ho ten
            hienThi1SV(a[i]); // In thong tin
            found = 1;
        }
    }
    if (!found) printf("Khong tim thay sinh vien!\n");
}

// Ham sap xep theo ten tang dan
void sapXep(SinhVien a[], int n) {
    for (int i = 0; i < n - 1; i++) {
        for (int j = i + 1; j < n; j++) {
            if (strcmp(a[i].hoTen, a[j].hoTen) > 0) { // So sanh chuoi
                SinhVien temp = a[i];
                a[i] = a[j];
                a[j] = temp; // Hoan doi neu dung thu tu
            }
        }
    }
    printf("Sap xep thanh cong!\n");
}

int main() {
    SinhVien a[100]; // Mang luu sinh vien
    int n = 0; // So luong sinh vien ban dau

    while (1) {
        printf("\n===== MENU =====\n");
        printf("1. Hien thi danh sach\n");
        printf("2. Them moi 1 sinh vien\n");
        printf("3. Cap nhat thong tin sinh vien\n");
        printf("4. Xoa sinh vien\n");
        printf("5. Tim kiem theo ten\n");
        printf("6. Sap xep theo ten tang dan\n");
        printf("7. Thoat\n");
        printf("Chon: ");

        int c;
        scanf("%d", &c); // Nhap lua chon

        switch (c) {
            case 1: hienThiDS(a, n); break;
            case 2: themSV(a, &n); break;
            case 3: capNhatSV(a, n); break;
            case 4: xoaSV(a, &n); break;
            case 5: timTheoTen(a, n); break;
            case 6: sapXep(a, n); break;
            case 7: return 0; // Thoat chuong trinh
            default: printf("Lua chon khong hop le!\n");
        }
    }
}
